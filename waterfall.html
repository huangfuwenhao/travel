<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>waterfall</title>
    <link rel="stylesheet" href="css/reset.css">
    <style>
        .container {
            width: 1200px;
            margin: 0 auto;
        }

        .box {
            width: 256px;
            float: left;
            border: 1px solid #ccc;
            padding: 10px;
            margin: 10px 10px;
            overflow: hidden;
        }

        .box .pic {
            width: 256px;
            overflow: hidden;
        }

        .box img {
            width: 256px;
            transform: scale(1);
        }

        .box:hover img {
            transform: scale(1.3);
            transition: all .5s;
        }

        .box .info {
            width: 100%;
            height: 30px;
            line-height: 40px;
            text-align: center;
        }

        .box .info i {
            font-style: none;
            display: inline-block;
            width: 12px;
            height: 12px;
            background: url(images/discover_bg.png) 0px -132px;
            margin-right: 5px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="box">
            <div class="pic"><img src="./waterfall/P_0 (1).png" alt=""></div>
            <div class="info"><i></i>北京</div>
        </div>
        <div class="box">
            <div class="pic"><img src="./waterfall/P_0 (2).png" alt=""></div>
            <div class="info"><i></i>上海</div>
        </div>
        <div class="box">
            <div class="pic"><img src="./waterfall/P_0 (1).jpeg" alt=""></div>
            <div class="info"><i></i>广州</div>
        </div>
        <div class="box">
            <div class="pic"><img src="./waterfall/P_0 (2).jpeg" alt=""></div>
            <div class="info"><i></i>深圳</div>
        </div>
        <div class="box">
            <div class="pic"><img src="./waterfall/P_0 (3).jpeg" alt=""></div>
            <div class="info"><i></i>天津</div>
        </div>
        <div class="box">
            <div class="pic"><img src="./waterfall/P_0 (4).jpeg" alt=""></div>
            <div class="info"><i></i>杭州</div>
        </div>
        <div class="box">
            <div class="pic"><img src="./waterfall/P_0 (1).jpg" alt=""></div>
            <div class="info"><i></i>南京</div>
        </div>
        <div class="box">
            <div class="pic"><img src="./waterfall/P_0 (2).jpg" alt=""></div>
            <div class="info"><i></i>武汉</div>
        </div>
        <div class="box">
            <div class="pic"><img src="./waterfall/P_0 (3).jpg" alt=""></div>
            <div class="info"><i></i>重庆</div>
        </div>
        <div class="box">
            <div class="pic"><img src="./waterfall/P_0 (4).jpg" alt=""></div>
            <div class="info"><i></i>拉萨</div>
        </div>
        <div class="box">
            <div class="pic"><img src="./waterfall/P_0 (5).jpg" alt=""></div>
            <div class="info"><i></i>海口</div>
        </div>
        <div class="box">
            <div class="pic"><img src="./waterfall/P_0 (6).jpg" alt=""></div>
            <div class="info"><i></i>三亚</div>
        </div>
        <div class="box">
            <div class="pic"><img src="./waterfall/P_0 (7).jpg" alt=""></div>
            <div class="info"><i></i>郑州</div>
        </div>
        <div class="box">
            <div class="pic"><img src="./waterfall/P_0 (8).jpg" alt=""></div>
            <div class="info"><i></i>济南</div>
        </div>
        <div class="box">
            <div class="pic"><img src="./waterfall/P_0 (9).jpg" alt=""></div>
            <div class="info"><i></i>合肥</div>
        </div>
        <div class="box">
            <div class="pic"><img src="./waterfall/P_0 (10).jpg" alt=""></div>
            <div class="info"><i></i>呼和浩特</div>
        </div>
        <div class="box">
            <div class="pic"><img src="./waterfall/P_0 (11).jpg" alt=""></div>
            <div class="info"><i></i>乌鲁木齐</div>
        </div>
        <div class="box">
            <div class="pic"><img src="./waterfall/P_0 (12).jpg" alt=""></div>
            <div class="info"><i></i>青岛</div>
        </div>
        <div class="box">
            <div class="pic"><img src="./waterfall/P_0 (13).jpg" alt=""></div>
            <div class="info"><i></i>大连</div>
        </div>
        <div class="box">
            <div class="pic"><img src="./waterfall/P_0 (14).jpg" alt=""></div>
            <div class="info"><i></i>宁波</div>
        </div>
        <div class="box">
            <div class="pic"><img src="./waterfall/P_0 (15).jpg" alt=""></div>
            <div class="info"><i></i>厦门</div>
        </div>
        <div class="box">
            <div class="pic"><img src="./waterfall/P_0 (16).jpg" alt=""></div>
            <div class="info"><i></i>福州</div>
        </div>
        <div class="box">
            <div class="pic"><img src="./waterfall/P_0 (17).jpg" alt=""></div>
            <div class="info"><i></i>台北</div>
        </div>
        <div class="box">
            <div class="pic"><img src="./waterfall/P_0 (18).jpg" alt=""></div>
            <div class="info"><i></i>香港</div>
        </div>
        <div class="box">
            <div class="pic"><img src="./waterfall/P_0 (19).jpg" alt=""></div>
            <div class="info"><i></i>澳门</div>
        </div>
        <div class="box">
            <div class="pic"><img src="./waterfall/P_0 (20).jpg" alt=""></div>
            <div class="info"><i></i>西安</div>
        </div>
        <div class="box">
            <div class="pic"><img src="./waterfall/P_0 (21).jpg" alt=""></div>
            <div class="info"><i></i>成都</div>
        </div>
        <div class="box">
            <div class="pic"><img src="./waterfall/P_0 (22).jpg" alt=""></div>
            <div class="info"><i></i>贵阳</div>
        </div>
        <div class="box">
            <div class="pic"><img src="./waterfall/P_0 (23).jpg" alt=""></div>
            <div class="info"><i></i>昆明</div>
        </div>
        <div class="box">
            <div class="pic"><img src="./waterfall/P_0 (24).jpg" alt=""></div>
            <div class="info"><i></i>长沙</div>
        </div>
        <div class="box">
            <div class="pic"><img src="./waterfall/P_0 (25).jpg" alt=""></div>
            <div class="info"><i></i>洛阳</div>
        </div>
        <div class="box">
            <div class="pic"><img src="./waterfall/P_0 (26).jpg" alt=""></div>
            <div class="info"><i></i>开封</div>
        </div>
    </div>
    <script>
        window.onload = function() {
            //1.计算列数
            var container = document.querySelector('.container');
            var boxes = container.children;
            var pageWidth = document.documentElement.clientWidth;
            var boxWidth = boxes[0].offsetWidth;
            var column = Math.floor(pageWidth / boxWidth);
            //2.获取最小
            var arrHeight = [];
            function waterfall() {
                for (var i = 0; i < boxes.length; i++) {
                    if (i < column) {
                        arrHeight[i] = boxes[i].offsetHeight;
                    } else {
                        var minHeight = getMin(arrHeight).value;
                        var minHeightIndex = getMin(arrHeight).index;
                        //3.摆放盒子
                        boxes[i].style.position = 'absolute';
                        boxes[i].style.left = boxes[minHeightIndex].offsetLeft + 'px';
                        boxes[i].style.top = minHeight + 'px';
                        boxes[i].style.marginLeft = 0 + 'px';
                        arrHeight[minHeightIndex] = minHeight + boxes[i].offsetHeight;
                    }
                }
            }
            waterfall();
            //4.判断触底
            window.onscroll = function() {
                if (bottomed()) {
                    //5.动态创建
                    var json = [
                        { "src": "./waterfall/P_0 (1).png", 'address': '郑州' },
                        { "src": "./waterfall/P_0 (2).png", 'address': '洛阳' },
                        { "src": "./waterfall/P_0 (1).jpeg", 'address': '开封' },
                        { "src": "./waterfall/P_0 (2).jpeg", 'address': '焦作' },
                        { "src": "./waterfall/P_0 (3).jpeg", 'address': '新乡' },
                        { "src": "./waterfall/P_0 (4).jpeg", 'address': '安阳' },
                        { "src": "./waterfall/P_0 (1).jpg", 'address': '鹤壁' },
                        { "src": "./waterfall/P_0 (2).jpg", 'address': '濮阳' },
                        { "src": "./waterfall/P_0 (3).jpg", 'address': '济源' },
                        { "src": "./waterfall/P_0 (4).jpg", 'address': '三门峡' },
                        { "src": "./waterfall/P_0 (5).jpg", 'address': '驻马店' },
                        { "src": "./waterfall/P_0 (6).jpg", 'address': '南阳' },
                        { "src": "./waterfall/P_0 (7).jpg", 'address': '平顶山' },
                        { "src": "./waterfall/P_0 (8).jpg", 'address': '信阳' },
                        { "src": "./waterfall/P_0 (9).jpg", 'address': '商丘' },
                        { "src": "./waterfall/P_0 (10).jpg", 'address': '周口' },
                        { "src": "./waterfall/P_0 (11).jpg", 'address': '鹿邑' },
                        { "src": "./waterfall/P_0 (12).jpg", 'address': '郸城' },
                        { "src": "./waterfall/P_0 (13).jpg", 'address': '太康' },
                        { "src": "./waterfall/P_0 (14).jpg", 'address': '淮阳' },
                        { "src": "./waterfall/P_0 (15).jpg", 'address': '商水' },
                        { "src": "./waterfall/P_0 (16).jpg", 'address': '西华' },
                        { "src": "./waterfall/P_0 (17).jpg", 'address': '扶沟' },
                        { "src": "./waterfall/P_0 (18).jpg", 'address': '项城' },
                        { "src": "./waterfall/P_0 (19).jpg", 'address': '漯河' },
                        { "src": "./waterfall/P_0 (20).jpg", 'address': '洛阳' },
                        { "src": "./waterfall/P_0 (21).jpg", 'address': '太原' },
                        { "src": "./waterfall/P_0 (22).jpg", 'address': '石家庄' },
                        { "src": "./waterfall/P_0 (23).jpg", 'address': '沈丘' },
                        { "src": "./waterfall/P_0 (24).jpg", 'address': '青海' },
                        { "src": "./waterfall/P_0 (25).jpg", 'address': '沈阳' },
                        { "src": "./waterfall/P_0 (26).jpg", 'address': '哈尔滨' },
                    ];
                    for (var i = 0; i < json.length; i++) {
                        var div = document.createElement('div');
                        div.className = 'box';
                        container.appendChild(div);

                        var pic = document.createElement('div');
                        pic.className = 'pic';
                        div.appendChild(pic);

                        var img = document.createElement('img');
                        img.src = json[i].src;
                        pic.appendChild(img);

                        var info = document.createElement('div');
                        info.className = 'info';
                        div.appendChild(info);

                        var icon = document.createElement('i');
                        info.appendChild(icon);

                        info.innerHTML += json[i].address;
                    }
                    waterfall();
                }
            }

            function bottomed() {
                var scrollTop = window.pageYOffset;
                var clientHeight = window.innerHeight;
                var lastBoxTop = boxes[boxes.length - 1].offsetTop;
                if (scrollTop + clientHeight > lastBoxTop) {
                    return true;
                } else {
                    return false;
                }
            }

            function getMin(arr) {
                var min = {};
                min.value = arr[0];
                min.index = 0;
                for (var i = 0; i < arr.length; i++) {
                    if (min.value > arr[i]) {
                        min.value = arr[i];
                        min.index = i;
                    }
                }
                return min;
            }
        };
    </script>
</body>
</html>